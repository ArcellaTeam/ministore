# `ministore` ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**WAL-based embedded state store –¥–ª—è Rust-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π**

---

### üéØ –¶–µ–ª—å

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å **–º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω–æ–µ, –Ω–∞–¥—ë–∂–Ω–æ–µ –∏ embeddable** —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è **—É–ø—Ä–∞–≤–ª—è—é—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è** (–º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, —Ä–µ–µ—Å—Ç—Ä–æ–≤), –≥–¥–µ:

- –ò–∑–º–µ–Ω–µ–Ω–∏—è **—Ä–µ–¥–∫–∏**, –Ω–æ **–∫—Ä–∏—Ç–∏—á–Ω—ã**.
- –ß—Ç–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å **–º–≥–Ω–æ–≤–µ–Ω–Ω—ã–º** (–∏–∑ –ø–∞–º—è—Ç–∏).
- –ó–∞–ø–∏—Å—å –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å **—É—Å—Ç–æ–π—á–∏–≤–∞ –∫ —Å–±–æ—è–º** (—á–µ—Ä–µ–∑ `fsync`).
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–∞–¥–µ–Ω–∏—è ‚Äî **–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ**.

> `ministore` ‚Äî —ç—Ç–æ **–Ω–µ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**, –∞ **–º–µ—Ö–∞–Ω–∏–∑–º –Ω–∞–¥—ë–∂–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º—É—Ç–∞—Ü–∏–π –∫ in-memory —Å–æ—Å—Ç–æ—è–Ω–∏—é**.

---

### üß© –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1. **–ü—Ä–æ—Å—Ç–æ—Ç–∞** ‚Äî < 300 —Å—Ç—Ä–æ–∫ —è–¥—Ä–∞, –±–µ–∑ —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á.
2. **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å** ‚Äî –∫–∞–∂–¥–∞—è –º—É—Ç–∞—Ü–∏—è —Å–Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –∂—É—Ä–Ω–∞–ª —Å `fsync()`.
3. **Generic-—Å–æ—Å—Ç–æ—è–Ω–∏–µ** ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º `T: Serialize + Deserialize`.
4. **–ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–π –∂—É—Ä–Ω–∞–ª** ‚Äî —Ñ–æ—Ä–º–∞—Ç JSONL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
5. **Zero runtime overhead** ‚Äî –Ω–µ—Ç GC, –∫–æ–º–ø–∞–∫—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏, –ø–æ—Ç–æ–∫–æ–≤.

---

### üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    MiniStore<T>       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ In-Memory ‚îÇ Append-   ‚îÇ
‚îÇ State: T  ‚îÇ Only      ‚îÇ
‚îÇ           ‚îÇ Journal   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

- **–ñ—É—Ä–Ω–∞–ª**: `journal.jsonl` ‚Äî append-only, immutable.
- **–°–æ—Å—Ç–æ—è–Ω–∏–µ**: –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏.
- **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ**: –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ ‚Äî replay –≤—Å–µ–≥–æ –∂—É—Ä–Ω–∞–ª–∞.

---

### üîÅ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–ø–∏—Å–∏

1. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞—ë—Ç –º—É—Ç–∞—Ü–∏—é `M`.
2. `ministore`:
   - –°–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç `M` ‚Üí —Å—Ç—Ä–æ–∫–∞.
   - –î–æ–±–∞–≤–ª—è–µ—Ç –≤ –∫–æ–Ω–µ—Ü `journal.jsonl`.
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç `fsync()`.
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç `M` –∫ in-memory —Å–æ—Å—Ç–æ—è–Ω–∏—é `T`.
3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Ok(())`.

> üí° –ú—É—Ç–∞—Ü–∏–∏ **–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å idempotent** –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ replay.

---

### üì¶ API

```rust
impl<T> MiniStore<T> {
    async fn open(path: &Path) -> Result<Self>;
    async fn apply<M>(&mut self, mutation: M) -> Result<()> 
    where M: Serialize;
    fn state(&self) -> &T;
}
```

---

### üö´ –ß—Ç–æ –ù–ï –¥–µ–ª–∞–µ—Ç `ministore`

- –ù–µ —Ö—Ä–∞–Ω–∏—Ç –±–∏–Ω–∞—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Å–æ–æ–±—â–µ–Ω–∏—è, –±–∞–π—Ç—ã).
- –ù–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –∏–ª–∏ –∏–Ω–¥–µ–∫—Å—ã.
- –ù–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–æ–º (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è `Arc<RwLock<...>>` —Å–Ω–∞—Ä—É–∂–∏).
- –ù–µ —è–≤–ª—è–µ—Ç—Å—è –±—Ä–æ–∫–µ—Ä–æ–º —Å–æ–æ–±—â–µ–Ω–∏–π.

---

### üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

`ministore` **–º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è** –∫–∞–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤ –¥—Ä—É–≥–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö, –Ω–∞–ø—Ä–∏–º–µ—Ä:
- **`walmq`** ‚Äî –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –±—Ä–æ–∫–µ—Ä–∞ (—Ç–æ–ø–∏–∫–∏, –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏, offsets).
- **`arcella`** ‚Äî –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–µ—Å—Ç—Ä–∞ –º–æ–¥—É–ª–µ–π –∏ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–π.
